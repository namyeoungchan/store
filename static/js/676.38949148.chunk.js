"use strict";(self.webpackChunkstore_inventory_system=self.webpackChunkstore_inventory_system||[]).push([[676],{4305:(e,s,a)=>{a.d(s,{A:()=>n});a(5043);var t=a(6183),r=a(579);const n=e=>{let{selectedWeek:s,onWeekChange:a}=e;const n=s===t.l.getCurrentWeekStart();return(0,r.jsxs)("div",{className:"week-selector",children:[(0,r.jsx)("button",{onClick:()=>{const e=new Date(s),t=new Date(e);t.setDate(e.getDate()-7),a(t.toISOString().split("T")[0])},className:"week-nav-btn",children:"\u2b05\ufe0f \uc774\uc804 \uc8fc"}),(0,r.jsxs)("div",{className:"week-display",children:[(0,r.jsx)("div",{className:"week-label",children:(e=>{const s=new Date(e),a=new Date(s);a.setDate(s.getDate()+6);const t=s.toLocaleDateString("ko-KR",{month:"short",day:"numeric"}),r=a.toLocaleDateString("ko-KR",{month:"short",day:"numeric"});return"".concat(t," ~ ").concat(r)})(s)}),!n&&(0,r.jsx)("button",{onClick:()=>{a(t.l.getCurrentWeekStart())},className:"current-week-btn",children:"\uc774\ubc88 \uc8fc\ub85c"})]}),(0,r.jsx)("button",{onClick:()=>{const e=new Date(s),t=new Date(e);t.setDate(e.getDate()+7),a(t.toISOString().split("T")[0])},className:"week-nav-btn",children:"\ub2e4\uc74c \uc8fc \u27a1\ufe0f"})]})}},5676:(e,s,a)=>{a.r(s),a.d(s,{default:()=>o});var t=a(5043),r=a(2555),n=a(7800);class d{static async createWorkRecord(e){const s=(0,r.A)((0,r.A)({},e),{},{created_at:(new Date).toISOString()}),{data:a,error:t}=await n.db.from("work_records").insert(s).select().single();if(t)throw t;return a}static async getWorkRecordById(e){const{data:s,error:a}=await n.db.from("work_records").select("*").eq("id",e).maybeSingle();if(a)throw a;return s}static async getWorkRecords(e){let s=n.db.from("work_records").select("*").order("work_date",{ascending:!1});null!==e&&void 0!==e&&e.userId&&(s=s.eq("user_id",e.userId)),null!==e&&void 0!==e&&e.startDate&&(s=s.gte("work_date",e.startDate)),null!==e&&void 0!==e&&e.endDate&&(s=s.lte("work_date",e.endDate));const{data:a,error:t}=await s;if(t)throw t;return a||[]}static async updateWorkRecord(e,s){const{error:a}=await n.db.from("work_records").update(s).eq("id",e);if(a)throw a}static async deleteWorkRecord(e){const{error:s}=await n.db.from("work_records").delete().eq("id",e);if(s)throw s}static async getWeeklyWorkSummary(e){const s=new Date(e),a=new Date(s);a.setDate(s.getDate()+6);const{data:t,error:r}=await n.db.from("work_records").select("\n        *,\n        users:user_id (\n          full_name\n        )\n      ").gte("work_date",e).lte("work_date",a.toISOString().split("T")[0]).order("work_date",{ascending:!0});if(r)throw r;const{data:d,error:l}=await n.db.from("users").select("id, full_name").eq("is_active",!0);if(l)throw l;const c=new Map;(t||[]).forEach(e=>{const s=e.user_id;c.has(s)||c.set(s,[]),c.get(s).push(e)});return(d||[]).map(s=>{const a=c.get(s.id)||[],t=a.reduce((e,s)=>e+(s.total_hours||0),0),r=a.reduce((e,s)=>e+(s.total_pay||0),0),n=a.length;return{user_id:s.id,user_name:s.full_name,week_start_date:e,total_hours:t,total_pay:r,work_days:n,records:a.map(e=>({id:e.id,user_id:e.user_id,work_date:e.work_date,start_time:e.start_time,end_time:e.end_time,break_minutes:e.break_minutes,total_hours:e.total_hours,total_pay:e.total_pay,notes:e.notes,created_at:e.created_at}))}})}static async getUserWorkRecordsForWeek(e,s){const a=new Date(s),t=new Date(a);t.setDate(a.getDate()+6);const{data:r,error:d}=await n.db.from("work_records").select("*").eq("user_id",e).gte("work_date",s).lte("work_date",t.toISOString().split("T")[0]).order("work_date",{ascending:!0});if(d)throw d;return r||[]}static async getUserTotalHoursForPeriod(e,s,a){const{data:t,error:r}=await n.db.from("work_records").select("total_hours").eq("user_id",e).gte("work_date",s).lte("work_date",a);if(r)throw r;return(t||[]).reduce((e,s)=>e+(s.total_hours||0),0)}static async getUserTotalPayForPeriod(e,s,a){const{data:t,error:r}=await n.db.from("work_records").select("total_pay").eq("user_id",e).gte("work_date",s).lte("work_date",a);if(r)throw r;return(t||[]).reduce((e,s)=>e+(s.total_pay||0),0)}}var l=a(6183),c=a(4305),i=a(579);const o=()=>{const[e,s]=(0,t.useState)(l.l.getCurrentWeekStart()),[a,r]=(0,t.useState)([]),[n,o]=(0,t.useState)(null),[u,m]=(0,t.useState)(!1),[h,_]=(0,t.useState)(null);(0,t.useEffect)(()=>{w()},[e]);const w=async()=>{try{m(!0),_(null);const s=await d.getWeeklyWorkSummary(e);r(s),o(null)}catch(s){_("\uadfc\ubb34\uc2dc\uac04 \ubd84\uc11d \ub370\uc774\ud130\ub97c \ubd88\ub7ec\uc624\ub294\ub370 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."),console.error("Error loading work time analysis:",s)}finally{m(!1)}},y=e=>"".concat(e.toLocaleString(),"\uc6d0"),k=e=>e.slice(0,5),x=a.reduce((e,s)=>({totalHours:e.totalHours+s.total_hours,totalPay:e.totalPay+s.total_pay,totalWorkDays:e.totalWorkDays+s.work_days}),{totalHours:0,totalPay:0,totalWorkDays:0});return(0,i.jsxs)("div",{className:"work-time-analysis",children:[(0,i.jsxs)("div",{className:"analysis-header",children:[(0,i.jsxs)("div",{className:"analysis-title",children:[(0,i.jsx)("h2",{children:"\ud83d\udcca \uadfc\ubb34\uc2dc\uac04 \ubd84\uc11d"}),(0,i.jsx)("p",{className:"analysis-subtitle",children:"\uc9c1\uc6d0\ub4e4\uc758 \uc8fc\uac04 \uadfc\ubb34\uc2dc\uac04\uacfc \uae09\uc5ec\ub97c \ubd84\uc11d\ud569\ub2c8\ub2e4"})]}),(0,i.jsx)(c.A,{selectedWeek:e,onWeekChange:s})]}),h&&(0,i.jsxs)("div",{className:"error-message",children:[(0,i.jsx)("span",{className:"error-icon",children:"\u26a0\ufe0f"}),h,(0,i.jsx)("button",{onClick:()=>_(null),className:"error-close",children:"\xd7"})]}),(0,i.jsx)("div",{className:"analysis-info",children:(0,i.jsxs)("div",{className:"week-info",children:[(0,i.jsx)("span",{className:"week-label",children:"\ubd84\uc11d \uae30\uac04:"}),(0,i.jsx)("span",{className:"week-range",children:(e=>{const s=new Date(e),a=new Date(s);return a.setDate(s.getDate()+6),"".concat(s.toLocaleDateString("ko-KR")," ~ ").concat(a.toLocaleDateString("ko-KR"))})(e)})]})}),u?(0,i.jsxs)("div",{className:"loading-container",children:[(0,i.jsx)("div",{className:"loading-spinner"}),(0,i.jsx)("p",{children:"\uadfc\ubb34\uc2dc\uac04 \ubd84\uc11d \uc911..."})]}):(0,i.jsxs)("div",{className:"analysis-content",children:[(0,i.jsxs)("div",{className:"summary-cards",children:[(0,i.jsxs)("div",{className:"summary-card",children:[(0,i.jsx)("div",{className:"card-icon",children:"\ud83d\udc65"}),(0,i.jsxs)("div",{className:"card-info",children:[(0,i.jsxs)("div",{className:"card-value",children:[a.length,"\uba85"]}),(0,i.jsx)("div",{className:"card-label",children:"\ud65c\ub3d9 \uc9c1\uc6d0"})]})]}),(0,i.jsxs)("div",{className:"summary-card",children:[(0,i.jsx)("div",{className:"card-icon",children:"\u23f1\ufe0f"}),(0,i.jsxs)("div",{className:"card-info",children:[(0,i.jsxs)("div",{className:"card-value",children:[x.totalHours.toFixed(1),"\uc2dc\uac04"]}),(0,i.jsx)("div",{className:"card-label",children:"\ucd1d \uadfc\ubb34\uc2dc\uac04"})]})]}),(0,i.jsxs)("div",{className:"summary-card",children:[(0,i.jsx)("div",{className:"card-icon",children:"\ud83d\udcb0"}),(0,i.jsxs)("div",{className:"card-info",children:[(0,i.jsx)("div",{className:"card-value",children:y(x.totalPay)}),(0,i.jsx)("div",{className:"card-label",children:"\ucd1d \uae09\uc5ec"})]})]}),(0,i.jsxs)("div",{className:"summary-card",children:[(0,i.jsx)("div",{className:"card-icon",children:"\ud83d\udcc5"}),(0,i.jsxs)("div",{className:"card-info",children:[(0,i.jsxs)("div",{className:"card-value",children:[x.totalWorkDays,"\uc77c"]}),(0,i.jsx)("div",{className:"card-label",children:"\ucd1d \uadfc\ubb34\uc77c"})]})]})]}),(0,i.jsxs)("div",{className:"analysis-grid",children:[(0,i.jsxs)("div",{className:"user-list-section",children:[(0,i.jsx)("h3",{children:"\uc9c1\uc6d0\ubcc4 \uadfc\ubb34 \ud604\ud669"}),0===a.length?(0,i.jsxs)("div",{className:"empty-state",children:[(0,i.jsx)("div",{className:"empty-icon",children:"\ud83d\udcca"}),(0,i.jsx)("h4",{children:"\uadfc\ubb34 \uae30\ub85d\uc774 \uc5c6\uc2b5\ub2c8\ub2e4"}),(0,i.jsx)("p",{children:"\uc774\ubc88 \uc8fc\uc5d0 \ub4f1\ub85d\ub41c \uadfc\ubb34 \uae30\ub85d\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."})]}):(0,i.jsx)("div",{className:"user-summary-list",children:a.map(e=>(0,i.jsxs)("div",{className:"user-summary-item ".concat((null===n||void 0===n?void 0:n.user_id)===e.user_id?"selected":""),onClick:()=>o(e),children:[(0,i.jsxs)("div",{className:"user-basic",children:[(0,i.jsx)("div",{className:"user-name",children:e.user_name}),(0,i.jsxs)("div",{className:"work-days",children:[e.work_days,"\uc77c \uadfc\ubb34"]})]}),(0,i.jsxs)("div",{className:"user-stats",children:[(0,i.jsxs)("div",{className:"stat-item",children:[(0,i.jsxs)("span",{className:"stat-value",children:[e.total_hours.toFixed(1),"\uc2dc\uac04"]}),(0,i.jsx)("span",{className:"stat-label",children:"\uadfc\ubb34\uc2dc\uac04"})]}),(0,i.jsxs)("div",{className:"stat-item",children:[(0,i.jsx)("span",{className:"stat-value",children:y(e.total_pay)}),(0,i.jsx)("span",{className:"stat-label",children:"\uae09\uc5ec"})]})]})]},e.user_id))})]}),(0,i.jsx)("div",{className:"user-detail-section",children:n?(0,i.jsxs)("div",{className:"user-detail",children:[(0,i.jsxs)("h3",{children:[n.user_name," \uc0c1\uc138 \uadfc\ubb34 \uae30\ub85d"]}),0===n.records.length?(0,i.jsx)("div",{className:"no-records",children:(0,i.jsx)("p",{children:"\uc774\ubc88 \uc8fc\uc5d0 \uadfc\ubb34 \uae30\ub85d\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."})}):(0,i.jsx)("div",{className:"work-records",children:n.records.map(e=>{return(0,i.jsxs)("div",{className:"work-record-item",children:[(0,i.jsx)("div",{className:"record-date",children:(s=e.work_date,new Date(s).toLocaleDateString("ko-KR",{month:"short",day:"numeric",weekday:"short"}))}),(0,i.jsxs)("div",{className:"record-time",children:[(0,i.jsxs)("span",{className:"time-range",children:[k(e.start_time)," ~ ",k(e.end_time)]}),(0,i.jsxs)("span",{className:"break-time",children:["(\ud734\uac8c ",e.break_minutes,"\ubd84)"]})]}),(0,i.jsxs)("div",{className:"record-stats",children:[(0,i.jsxs)("span",{className:"hours",children:[e.total_hours.toFixed(1),"\uc2dc\uac04"]}),(0,i.jsx)("span",{className:"pay",children:y(e.total_pay)})]}),e.notes&&(0,i.jsx)("div",{className:"record-notes",children:e.notes})]},e.id);var s})})]}):(0,i.jsxs)("div",{className:"select-user-prompt",children:[(0,i.jsx)("div",{className:"prompt-icon",children:"\ud83d\udc48"}),(0,i.jsx)("h4",{children:"\uc9c1\uc6d0\uc744 \uc120\ud0dd\ud558\uc138\uc694"}),(0,i.jsx)("p",{children:"\uc67c\ucabd \ubaa9\ub85d\uc5d0\uc11c \uc9c1\uc6d0\uc744 \ud074\ub9ad\ud558\uba74 \uc0c1\uc138 \uadfc\ubb34 \uae30\ub85d\uc744 \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."})]})})]})]})]})}},6183:(e,s,a)=>{a.d(s,{l:()=>n});var t=a(2555),r=a(7800);class n{static async getScheduleByUserAndWeek(e,s){try{const{data:a,error:t}=await r.N.from(this.tableName).select("*").eq("user_id",e).eq("week_start_date",s).single();if(t){if("PGRST116"===t.code)return null;throw t}return a}catch(a){return console.error("Error getting schedule by user and week:",a),null}}static async createOrUpdateSchedule(e){try{const s=await this.getScheduleByUserAndWeek(e.user_id,e.week_start_date),a={user_id:e.user_id,week_start_date:e.week_start_date,monday_start:e.monday_start||null,monday_end:e.monday_end||null,tuesday_start:e.tuesday_start||null,tuesday_end:e.tuesday_end||null,wednesday_start:e.wednesday_start||null,wednesday_end:e.wednesday_end||null,thursday_start:e.thursday_start||null,thursday_end:e.thursday_end||null,friday_start:e.friday_start||null,friday_end:e.friday_end||null,saturday_start:e.saturday_start||null,saturday_end:e.saturday_end||null,sunday_start:e.sunday_start||null,sunday_end:e.sunday_end||null};if(s){const{data:e,error:t}=await r.N.from(this.tableName).update(a).eq("id",s.id).select().single();if(t)throw t;return e}{const{data:e,error:s}=await r.N.from(this.tableName).insert(a).select().single();if(s)throw s;return e}}catch(s){throw console.error("Error creating or updating schedule:",s),s}}static async getWeekSchedules(e){try{const{data:s,error:a}=await r.N.from(this.tableName).select("\n          *,\n          users!inner(\n            full_name,\n            is_active\n          )\n        ").eq("week_start_date",e).eq("users.is_active",!0);if(a)throw a;return(s||[]).map(e=>(0,t.A)((0,t.A)({},e),{},{user_name:e.users.full_name})).sort((e,s)=>e.user_name.localeCompare(s.user_name))}catch(s){return console.error("Error getting week schedules:",s),[]}}static async deleteSchedule(e,s){try{const{error:a}=await r.N.from(this.tableName).delete().eq("user_id",e).eq("week_start_date",s);if(a)throw a;return!0}catch(a){return console.error("Error deleting schedule:",a),!1}}static getWeekDates(e){const s=new Date(e),a=[];for(let t=0;t<7;t++){const e=new Date(s);e.setDate(s.getDate()+t),a.push(e.toISOString().split("T")[0])}return a}static getCurrentWeekStart(){const e=new Date,s=e.getDay(),a=e.getDate()-s+(0===s?-6:1);return new Date(e.setDate(a)).toISOString().split("T")[0]}static getWeekStartByDate(e){const s=new Date(e),a=s.getDay(),t=s.getDate()-a+(0===a?-6:1);return new Date(s.setDate(t)).toISOString().split("T")[0]}}n.tableName="work_schedules"}}]);
//# sourceMappingURL=676.38949148.chunk.js.map