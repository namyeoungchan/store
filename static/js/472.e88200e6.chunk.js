"use strict";(self.webpackChunkstore_inventory_system=self.webpackChunkstore_inventory_system||[]).push([[472],{5472:(n,e,t)=>{t.r(e),t.d(e,{default:()=>s});var r=t(5043),a=t(52),i=t(4241),d=t(2408),o=t(579);const s=n=>{let{onOrderUpdate:e}=n;const[t,s]=(0,r.useState)([]),[c,l]=(0,r.useState)(null),[m,u]=(0,r.useState)([]),[g,h]=(0,r.useState)(!1),[f,p]=(0,r.useState)(""),[x,b]=(0,r.useState)("");(0,r.useEffect)(()=>{w()},[]);const w=async()=>{try{const n=await a.Q.getAllOrders();s(n.sort((n,e)=>new Date(e.order_date||0).getTime()-new Date(n.order_date||0).getTime()))}catch(n){p("\uc8fc\ubb38 \ubaa9\ub85d\uc744 \ubd88\ub7ec\uc624\ub294\ub370 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4.")}},y=async n=>{try{const e=await a.Q.getOrderItemsWithDetails(n);u(e)}catch(e){p("\uc8fc\ubb38 \uc0c1\uc138 \uc815\ubcf4\ub97c \ubd88\ub7ec\uc624\ub294\ub370 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4.")}},j=async(n,t,r,o,s)=>{if(s<=0)return void await v(n,t,r,o);const c=s-o,l=c>0?"\uc218\ub7c9\uc744 ".concat(o,"\uac1c\uc5d0\uc11c ").concat(s,"\uac1c\ub85c \uc99d\uac00\uc2dc\ud0a4\uc2dc\uaca0\uc2b5\ub2c8\uae4c?\n(\uc7ac\uace0\uc5d0\uc11c \ucd94\uac00\ub85c \ucc28\uac10\ub429\ub2c8\ub2e4)"):"\uc218\ub7c9\uc744 ".concat(o,"\uac1c\uc5d0\uc11c ").concat(s,"\uac1c\ub85c \uac10\uc18c\uc2dc\ud0a4\uc2dc\uaca0\uc2b5\ub2c8\uae4c?\n(\uc7ac\uace0\uc5d0 \ubc18\ud658\ub429\ub2c8\ub2e4)");if(window.confirm(l)){h(!0),p("");try{const o=await i.$.getRecipesByMenuId(r);for(const e of o){const t=e.quantity*Math.abs(c);if(c>0){const r=await d.c.getInventoryByIngredientId(e.ingredient_id);if(!r||r.current_stock<t)return p("\uc7ac\uace0\uac00 \ubd80\uc871\ud569\ub2c8\ub2e4: ".concat(e.ingredient_name," (\ud544\uc694: ").concat(t,", \uc7ac\uace0: ").concat((null===r||void 0===r?void 0:r.current_stock)||0,")")),void h(!1);await d.c.adjustStock(e.ingredient_id,t,"OUT","\uc8fc\ubb38 \uc218\uc815 #".concat(n," - \uc218\ub7c9 \uc99d\uac00"))}else await d.c.adjustStock(e.ingredient_id,t,"IN","\uc8fc\ubb38 \uc218\uc815 #".concat(n," - \uc218\ub7c9 \uac10\uc18c"))}await a.Q.updateOrderItemQuantity(t,s);const l=(await a.Q.getOrderItemsWithDetails(n)).reduce((n,e)=>n+e.quantity*e.unit_price,0);await a.Q.updateOrderTotal(n,l),b("\uc8fc\ubb38\uc774 \uc131\uacf5\uc801\uc73c\ub85c \uc218\uc815\ub418\uc5c8\uc2b5\ub2c8\ub2e4."),await w(),await y(n),e&&e()}catch(m){p(m instanceof Error?m.message:"\uc8fc\ubb38 \uc218\uc815 \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.")}finally{h(!1)}}},v=async(n,t,r,o)=>{if(window.confirm("\uc774 \uba54\ub274\ub97c \uc8fc\ubb38\uc5d0\uc11c \uc81c\uac70\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?\n\uc7ac\uace0\uac00 \ubc18\ud658\ub429\ub2c8\ub2e4.")){h(!0),p("");try{const s=await i.$.getRecipesByMenuId(r);for(const e of s){const t=e.quantity*o;await d.c.adjustStock(e.ingredient_id,t,"IN","\uc8fc\ubb38 \uc544\uc774\ud15c \uc81c\uac70 #".concat(n))}await a.Q.deleteOrderItem(t);const c=await a.Q.getOrderItemsWithDetails(n);if(0===c.length)await a.Q.deleteOrder(n),l(null),u([]);else{const e=c.reduce((n,e)=>n+e.quantity*e.unit_price,0);await a.Q.updateOrderTotal(n,e),await y(n)}b("\uc8fc\ubb38 \uc544\uc774\ud15c\uc774 \uc81c\uac70\ub418\uc5c8\uc2b5\ub2c8\ub2e4."),await w(),e&&e()}catch(s){p(s instanceof Error?s.message:"\uc544\uc774\ud15c \uc81c\uac70 \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.")}finally{h(!1)}}},N=n=>n?new Date(n).toLocaleString("ko-KR",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"\ub0a0\uc9dc \uc5c6\uc74c";return(0,o.jsxs)("div",{className:"order-management",children:[(0,o.jsxs)("div",{className:"management-header",children:[(0,o.jsx)("h2",{children:"\ud83d\udccb \uc8fc\ubb38 \uad00\ub9ac"}),f&&(0,o.jsx)("div",{className:"alert alert-error",children:f}),x&&(0,o.jsx)("div",{className:"alert alert-success",children:x})]}),(0,o.jsxs)("div",{className:"management-content",children:[(0,o.jsxs)("div",{className:"orders-list",children:[(0,o.jsxs)("h3",{children:["\uc8fc\ubb38 \ubaa9\ub85d (",t.length,")"]}),0===t.length?(0,o.jsx)("div",{className:"empty-state",children:(0,o.jsx)("p",{children:"\uc8fc\ubb38\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."})}):(0,o.jsx)("div",{className:"orders-grid",children:t.map(n=>(0,o.jsxs)("div",{className:"order-card ".concat((null===c||void 0===c?void 0:c.id)===n.id?"selected":""),onClick:()=>(n=>{l(n),y(n.id)})(n),children:[(0,o.jsxs)("div",{className:"order-header",children:[(0,o.jsxs)("span",{className:"order-id",children:["\uc8fc\ubb38 #",n.id]}),(0,o.jsx)("span",{className:"order-date",children:N(n.order_date)})]}),(0,o.jsxs)("div",{className:"order-amount",children:["\u20a9",n.total_amount.toLocaleString()]}),(0,o.jsx)("button",{className:"btn btn-danger btn-small",onClick:t=>{t.stopPropagation(),(async n=>{const t="\n\uc8fc\ubb38 #".concat(n.id,"\ub97c \ucde8\uc18c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?\n\n\ucde8\uc18c \uc2dc \uc0ac\uc6a9\ub41c \uc7ac\ub8cc\uac00 \uc7ac\uace0\uc5d0 \ub2e4\uc2dc \ucd94\uac00\ub429\ub2c8\ub2e4.\n\uc774 \uc791\uc5c5\uc740 \ub418\ub3cc\ub9b4 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.");if(window.confirm(t)){h(!0),p("");try{const t=await a.Q.getOrderItemsWithDetails(n.id);for(const e of t){const t=await i.$.getRecipesByMenuId(e.menu_id);for(const r of t){const t=r.quantity*e.quantity;await d.c.adjustStock(r.ingredient_id,t,"IN","\uc8fc\ubb38 \ucde8\uc18c #".concat(n.id," - ").concat(e.menu_name))}}await a.Q.deleteOrder(n.id),b("\uc8fc\ubb38\uc774 \uc131\uacf5\uc801\uc73c\ub85c \ucde8\uc18c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."),await w(),(null===c||void 0===c?void 0:c.id)===n.id&&(l(null),u([])),e&&e()}catch(r){p(r instanceof Error?r.message:"\uc8fc\ubb38 \ucde8\uc18c \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.")}finally{h(!1)}}})(n)},disabled:g,children:"\ucde8\uc18c"})]},n.id))})]}),c&&(0,o.jsxs)("div",{className:"order-details",children:[(0,o.jsxs)("h3",{children:["\uc8fc\ubb38 \uc0c1\uc138 - #",c.id]}),(0,o.jsxs)("div",{className:"order-info",children:[(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"\uc8fc\ubb38 \uc2dc\uac04:"})," ",N(c.order_date)]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"\ucd1d \uae08\uc561:"})," \u20a9",c.total_amount.toLocaleString()]})]}),(0,o.jsxs)("div",{className:"order-items",children:[(0,o.jsx)("h4",{children:"\uc8fc\ubb38 \uba54\ub274"}),m.map(n=>(0,o.jsxs)("div",{className:"order-item",children:[(0,o.jsxs)("div",{className:"item-info",children:[(0,o.jsx)("h5",{children:n.menu_name}),(0,o.jsxs)("p",{children:["\ub2e8\uac00: \u20a9",n.unit_price.toLocaleString()]})]}),(0,o.jsxs)("div",{className:"item-controls",children:[(0,o.jsxs)("div",{className:"quantity-controls",children:[(0,o.jsx)("button",{className:"btn btn-small",onClick:()=>j(c.id,n.id,n.menu_id,n.quantity,n.quantity-1),disabled:g,children:"-"}),(0,o.jsx)("span",{className:"quantity",children:n.quantity}),(0,o.jsx)("button",{className:"btn btn-small",onClick:()=>j(c.id,n.id,n.menu_id,n.quantity,n.quantity+1),disabled:g,children:"+"})]}),(0,o.jsx)("button",{className:"btn btn-danger btn-small",onClick:()=>v(c.id,n.id,n.menu_id,n.quantity),disabled:g,children:"\uc81c\uac70"})]}),(0,o.jsxs)("div",{className:"item-total",children:["\u20a9",(n.quantity*n.unit_price).toLocaleString()]})]},n.id))]})]})]}),(0,o.jsx)("style",{children:"\n        .order-management {\n          max-width: 1200px;\n          margin: 0 auto;\n          padding: 2rem;\n        }\n\n        .management-header {\n          margin-bottom: 2rem;\n        }\n\n        .management-header h2 {\n          margin: 0 0 1rem 0;\n          color: #333;\n        }\n\n        .alert {\n          padding: 0.75rem 1rem;\n          border-radius: 4px;\n          margin-bottom: 1rem;\n        }\n\n        .alert-error {\n          background-color: #ffeaea;\n          color: #d32f2f;\n          border: 1px solid #ffcdd2;\n        }\n\n        .alert-success {\n          background-color: #e8f5e8;\n          color: #4caf50;\n          border: 1px solid #c8e6c9;\n        }\n\n        .management-content {\n          display: grid;\n          grid-template-columns: 1fr 1fr;\n          gap: 2rem;\n        }\n\n        .orders-list h3, .order-details h3 {\n          margin: 0 0 1rem 0;\n          color: #333;\n        }\n\n        .empty-state {\n          text-align: center;\n          padding: 2rem;\n          color: #999;\n          background: white;\n          border-radius: 8px;\n          border: 1px solid #eee;\n        }\n\n        .orders-grid {\n          display: flex;\n          flex-direction: column;\n          gap: 1rem;\n        }\n\n        .order-card {\n          background: white;\n          border: 1px solid #ddd;\n          border-radius: 8px;\n          padding: 1rem;\n          cursor: pointer;\n          transition: all 0.2s;\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n        }\n\n        .order-card:hover {\n          border-color: #2196f3;\n          box-shadow: 0 2px 8px rgba(33, 150, 243, 0.2);\n        }\n\n        .order-card.selected {\n          border-color: #2196f3;\n          background-color: #f3f9ff;\n          box-shadow: 0 2px 8px rgba(33, 150, 243, 0.3);\n        }\n\n        .order-header {\n          display: flex;\n          flex-direction: column;\n          gap: 0.25rem;\n        }\n\n        .order-id {\n          font-weight: bold;\n          color: #333;\n        }\n\n        .order-date {\n          font-size: 0.85rem;\n          color: #666;\n        }\n\n        .order-amount {\n          font-size: 1.1rem;\n          font-weight: bold;\n          color: #2196f3;\n        }\n\n        .order-details {\n          background: white;\n          border-radius: 8px;\n          padding: 1.5rem;\n          box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n        }\n\n        .order-info {\n          background: #f8f9fa;\n          padding: 1rem;\n          border-radius: 4px;\n          margin-bottom: 1.5rem;\n        }\n\n        .order-info p {\n          margin: 0.5rem 0;\n        }\n\n        .order-items h4 {\n          margin: 0 0 1rem 0;\n          color: #333;\n        }\n\n        .order-item {\n          display: grid;\n          grid-template-columns: 1fr auto auto;\n          gap: 1rem;\n          align-items: center;\n          padding: 1rem 0;\n          border-bottom: 1px solid #eee;\n        }\n\n        .order-item:last-child {\n          border-bottom: none;\n        }\n\n        .item-info h5 {\n          margin: 0 0 0.25rem 0;\n          font-size: 1rem;\n        }\n\n        .item-info p {\n          margin: 0;\n          color: #666;\n          font-size: 0.9rem;\n        }\n\n        .item-controls {\n          display: flex;\n          flex-direction: column;\n          gap: 0.5rem;\n          align-items: center;\n        }\n\n        .quantity-controls {\n          display: flex;\n          align-items: center;\n          gap: 0.5rem;\n        }\n\n        .quantity {\n          min-width: 2rem;\n          text-align: center;\n          font-weight: bold;\n        }\n\n        .item-total {\n          font-weight: bold;\n          color: #2196f3;\n          text-align: right;\n        }\n\n        .btn {\n          border: none;\n          border-radius: 4px;\n          padding: 0.5rem 1rem;\n          cursor: pointer;\n          font-size: 0.9rem;\n          transition: all 0.2s;\n          font-weight: 500;\n        }\n\n        .btn:hover:not(:disabled) {\n          transform: translateY(-1px);\n          box-shadow: 0 2px 8px rgba(0,0,0,0.2);\n        }\n\n        .btn:disabled {\n          opacity: 0.6;\n          cursor: not-allowed;\n        }\n\n        .btn-danger {\n          background: #f44336;\n          color: white;\n        }\n\n        .btn-small {\n          padding: 0.25rem 0.5rem;\n          font-size: 0.8rem;\n        }\n\n        @media (max-width: 768px) {\n          .management-content {\n            grid-template-columns: 1fr;\n          }\n\n          .order-card {\n            flex-direction: column;\n            align-items: flex-start;\n            gap: 0.5rem;\n          }\n\n          .order-item {\n            grid-template-columns: 1fr;\n            gap: 0.5rem;\n          }\n\n          .item-controls {\n            flex-direction: row;\n            justify-content: space-between;\n            width: 100%;\n          }\n        }\n      "})]})}}}]);
//# sourceMappingURL=472.e88200e6.chunk.js.map