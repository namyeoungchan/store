"use strict";(self.webpackChunkstore_inventory_system=self.webpackChunkstore_inventory_system||[]).push([[846],{3846:(e,t,a)=>{a.r(t),a.d(t,{default:()=>c});var s=a(2555),d=a(5043),i=a(7800);class r{static async createFixedSchedule(e){const t=(0,s.A)((0,s.A)({},e),{},{created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}),{data:a,error:d}=await i.db.from("fixed_schedules").insert(t).select().single();if(d)throw d;return a}static async getFixedSchedulesByUser(e){const{data:t,error:a}=await i.db.from("fixed_schedules").select("*").eq("user_id",e).order("effective_from",{ascending:!1});if(a)throw a;return t||[]}static async getAllFixedSchedules(){return this.getAllFixedSchedulesWithUsers()}static async getAllFixedSchedulesWithUsers(){const{data:e,error:t}=await i.db.from("fixed_schedules").select("\n        *,\n        users:user_id (\n          full_name,\n          position\n        )\n      ").order("effective_from",{ascending:!1});if(t)throw t;return(e||[]).map(e=>{var t,a;return(0,s.A)((0,s.A)({},e),{},{user_name:(null===(t=e.users)||void 0===t?void 0:t.full_name)||"",user_position:(null===(a=e.users)||void 0===a?void 0:a.position)||""})})}static async getActiveFixedScheduleByUser(e){const{data:t,error:a}=await i.db.from("fixed_schedules").select("*").eq("user_id",e).eq("is_active",!0).lte("effective_from",(new Date).toISOString()).or("effective_until.is.null,effective_until.gte.".concat((new Date).toISOString())).order("effective_from",{ascending:!1}).limit(1).maybeSingle();if(a)throw a;return t}static async updateFixedSchedule(e,t){const{error:a}=await i.db.from("fixed_schedules").update((0,s.A)((0,s.A)({},t),{},{updated_at:(new Date).toISOString()})).eq("id",e);if(a)throw a}static async deleteFixedSchedule(e){const{error:t}=await i.db.from("fixed_schedules").delete().eq("id",e);if(t)throw t}static async deactivateFixedSchedule(e,t){const{data:a,error:s}=await i.db.from("fixed_schedules").select("*").eq("id",e).single();if(s)throw s;if(!a)throw new Error("Fixed schedule not found");const{error:d}=await i.db.from("fixed_schedules").update({effective_until:t,updated_at:(new Date).toISOString()}).eq("id",e);if(d)throw d;const r=new Date(t);r.setDate(r.getDate()+1);const n={user_id:a.user_id,name:"".concat(a.name," (\ube44\ud65c\uc131\ud654\ub428)"),description:a.description,monday_start:null,monday_end:null,tuesday_start:null,tuesday_end:null,wednesday_start:null,wednesday_end:null,thursday_start:null,thursday_end:null,friday_start:null,friday_end:null,saturday_start:null,saturday_end:null,sunday_start:null,sunday_end:null,is_active:!1,effective_from:r.toISOString().split("T")[0],effective_until:null,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},{error:l}=await i.db.from("fixed_schedules").insert(n);if(l)throw l}static async applyFixedScheduleToWeek(e,t){const{data:a,error:s}=await i.db.from("fixed_schedules").select("*").eq("id",e).single();if(s)throw s;if(!a)throw new Error("Fixed schedule not found");const{error:d}=await i.db.from("work_schedules").delete().eq("user_id",a.user_id).eq("week_start_date",t);if(d)throw d;const r={user_id:a.user_id,week_start_date:t,monday_start:a.monday_start,monday_end:a.monday_end,tuesday_start:a.tuesday_start,tuesday_end:a.tuesday_end,wednesday_start:a.wednesday_start,wednesday_end:a.wednesday_end,thursday_start:a.thursday_start,thursday_end:a.thursday_end,friday_start:a.friday_start,friday_end:a.friday_end,saturday_start:a.saturday_start,saturday_end:a.saturday_end,sunday_start:a.sunday_start,sunday_end:a.sunday_end,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},{error:n}=await i.db.from("work_schedules").insert(r);if(n)throw n}static async getFixedScheduleById(e){const{data:t,error:a}=await i.db.from("fixed_schedules").select("*").eq("id",e).maybeSingle();if(a)throw a;return t}static async activateFixedSchedule(e){const{error:t}=await i.db.from("fixed_schedules").update({is_active:!0,updated_at:(new Date).toISOString()}).eq("id",e);if(t)throw t}static async cloneFixedSchedule(e,t){const a=await this.getFixedScheduleById(e);if(!a)throw new Error("Original schedule not found");const d=(0,s.A)((0,s.A)((0,s.A)({},a),t),{},{id:void 0,created_at:void 0,updated_at:void 0});return this.createFixedSchedule(d)}}var n=a(579);const l=[{key:"monday",label:"\uc6d4\uc694\uc77c"},{key:"tuesday",label:"\ud654\uc694\uc77c"},{key:"wednesday",label:"\uc218\uc694\uc77c"},{key:"thursday",label:"\ubaa9\uc694\uc77c"},{key:"friday",label:"\uae08\uc694\uc77c"},{key:"saturday",label:"\ud1a0\uc694\uc77c"},{key:"sunday",label:"\uc77c\uc694\uc77c"}],c=e=>{let{users:t}=e;const[a,i]=(0,d.useState)([]),[c,o]=(0,d.useState)(""),[u,h]=(0,d.useState)(!1),[_,m]=(0,d.useState)(null),[y,f]=(0,d.useState)(!0),[x,v]=(0,d.useState)(null),[p,w]=(0,d.useState)({user_id:"",name:"",description:"",monday_start:"",monday_end:"",tuesday_start:"",tuesday_end:"",wednesday_start:"",wednesday_end:"",thursday_start:"",thursday_end:"",friday_start:"",friday_end:"",saturday_start:"",saturday_end:"",sunday_start:"",sunday_end:"",effective_from:(new Date).toISOString().split("T")[0],effective_until:""});(0,d.useEffect)(()=>{j()},[]);const j=async()=>{try{f(!0),v(null);const e=await r.getAllFixedSchedules();i(e)}catch(e){v("\uace0\uc815 \uc2a4\ucf00\uc904\uc744 \ubd88\ub7ec\uc624\ub294\ub370 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."),console.error("Error loading fixed schedules:",e)}finally{f(!1)}},g=()=>{m(null),w({user_id:c||(t.length>0?t[0].id:""),name:"",description:"",monday_start:"",monday_end:"",tuesday_start:"",tuesday_end:"",wednesday_start:"",wednesday_end:"",thursday_start:"",thursday_end:"",friday_start:"",friday_end:"",saturday_start:"",saturday_end:"",sunday_start:"",sunday_end:"",effective_from:(new Date).toISOString().split("T")[0],effective_until:""}),h(!0)},S=e=>e?e.substring(0,5):"-",N=c?a.filter(e=>e.user_id===c):a;return y?(0,n.jsxs)("div",{className:"loading-container",children:[(0,n.jsx)("div",{className:"loading-spinner"}),(0,n.jsx)("p",{children:"\uace0\uc815 \uc2a4\ucf00\uc904\uc744 \ubd88\ub7ec\uc624\ub294 \uc911..."})]}):(0,n.jsxs)("div",{className:"fixed-schedule-management",children:[(0,n.jsxs)("div",{className:"schedule-header",children:[(0,n.jsxs)("div",{className:"header-left",children:[(0,n.jsx)("h2",{className:"schedule-title",children:"\uace0\uc815 \uc2a4\ucf00\uc904 \uad00\ub9ac"}),(0,n.jsx)("p",{className:"schedule-subtitle",children:"\uc9c1\uc6d0\ubcc4 \uace0\uc815 \uadfc\ubb34 \uc2a4\ucf00\uc904\uc744 \uad00\ub9ac\ud558\uace0 \uc8fc\uac04 \uc2a4\ucf00\uc904\uc5d0 \uc801\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4"})]}),(0,n.jsxs)("button",{onClick:g,className:"modern-primary-button",children:[(0,n.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,n.jsx)("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),(0,n.jsx)("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"\uc0c8 \uace0\uc815 \uc2a4\ucf00\uc904"]})]}),x&&(0,n.jsxs)("div",{className:"error-message",children:[(0,n.jsx)("span",{className:"error-icon",children:"\u26a0\ufe0f"}),x,(0,n.jsx)("button",{onClick:()=>v(null),className:"error-close",children:"\xd7"})]}),(0,n.jsxs)("div",{className:"user-filter",children:[(0,n.jsx)("label",{htmlFor:"user-select",children:"\uc9c1\uc6d0 \ud544\ud130:"}),(0,n.jsxs)("select",{id:"user-select",value:c,onChange:e=>o("0"===e.target.value?"":e.target.value),className:"modern-select",children:[(0,n.jsx)("option",{value:"",children:"\uc804\uccb4 \uc9c1\uc6d0"}),t.map(e=>(0,n.jsxs)("option",{value:e.id,children:[e.full_name," (",e.position,")"]},e.id))]})]}),(0,n.jsx)("div",{className:"schedules-grid",children:0===N.length?(0,n.jsxs)("div",{className:"empty-state",children:[(0,n.jsx)("div",{className:"empty-icon",children:"\ud83d\udcc5"}),(0,n.jsx)("h3",{children:"\ub4f1\ub85d\ub41c \uace0\uc815 \uc2a4\ucf00\uc904\uc774 \uc5c6\uc2b5\ub2c8\ub2e4"}),(0,n.jsx)("p",{children:"\uccab \ubc88\uc9f8 \uace0\uc815 \uc2a4\ucf00\uc904\uc744 \uc0dd\uc131\ud574\ubcf4\uc138\uc694."}),(0,n.jsx)("button",{onClick:g,className:"modern-primary-button",children:"\uace0\uc815 \uc2a4\ucf00\uc904 \ub9cc\ub4e4\uae30"})]}):N.map(e=>(0,n.jsxs)("div",{className:"schedule-card ".concat(e.is_active?"":"inactive"),children:[(0,n.jsxs)("div",{className:"card-header",children:[(0,n.jsxs)("div",{className:"schedule-info",children:[(0,n.jsx)("h3",{className:"schedule-name",children:e.name}),(0,n.jsxs)("p",{className:"schedule-user",children:[e.user_name," (",e.user_position,")"]}),e.description&&(0,n.jsx)("p",{className:"schedule-description",children:e.description})]}),(0,n.jsx)("div",{className:"schedule-status",children:(0,n.jsx)("span",{className:"status-badge ".concat(e.is_active?"active":"inactive"),children:e.is_active?"\ud65c\uc131":"\ube44\ud65c\uc131"})})]}),(0,n.jsxs)("div",{className:"schedule-details",children:[(0,n.jsxs)("div",{className:"schedule-period",children:[(0,n.jsx)("span",{className:"period-label",children:"\uc801\uc6a9 \uae30\uac04:"}),(0,n.jsxs)("span",{className:"period-dates",children:[new Date(e.effective_from).toLocaleDateString("ko-KR"),e.effective_until&&(0,n.jsxs)(n.Fragment,{children:[" ~ ",new Date(e.effective_until).toLocaleDateString("ko-KR")]}),!e.effective_until&&(0,n.jsx)(n.Fragment,{children:" ~ \uacc4\uc18d"})]})]}),(0,n.jsx)("div",{className:"weekly-schedule",children:l.map(t=>(0,n.jsxs)("div",{className:"day-schedule",children:[(0,n.jsx)("span",{className:"day-label",children:t.label}),(0,n.jsx)("span",{className:"day-times",children:e["".concat(t.key,"_start")]&&e["".concat(t.key,"_end")]?(0,n.jsxs)(n.Fragment,{children:[S(e["".concat(t.key,"_start")])," ~"," ",S(e["".concat(t.key,"_end")])]}):(0,n.jsx)("span",{className:"no-work",children:"\ud734\ubb34"})})]},t.key))})]}),(0,n.jsxs)("div",{className:"card-actions",children:[(0,n.jsx)("button",{onClick:()=>(e=>{m(e),w({user_id:e.user_id,name:e.name,description:e.description||"",monday_start:e.monday_start||"",monday_end:e.monday_end||"",tuesday_start:e.tuesday_start||"",tuesday_end:e.tuesday_end||"",wednesday_start:e.wednesday_start||"",wednesday_end:e.wednesday_end||"",thursday_start:e.thursday_start||"",thursday_end:e.thursday_end||"",friday_start:e.friday_start||"",friday_end:e.friday_end||"",saturday_start:e.saturday_start||"",saturday_end:e.saturday_end||"",sunday_start:e.sunday_start||"",sunday_end:e.sunday_end||"",effective_from:e.effective_from,effective_until:e.effective_until||""}),h(!0)})(e),className:"action-button edit",title:"\ud3b8\uc9d1",children:(0,n.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,n.jsx)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),(0,n.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),(0,n.jsx)("button",{onClick:()=>(async e=>{const t=prompt("\uc0c8\ub85c\uc6b4 \uc2a4\ucf00\uc904 \uc774\ub984\uc744 \uc785\ub825\ud558\uc138\uc694:","".concat(e.name," (\ubcf5\uc0ac\ubcf8)"));if(t)try{await r.cloneFixedSchedule(e.id,{name:t,effective_from:(new Date).toISOString().split("T")[0]}),await j()}catch(a){v("\uace0\uc815 \uc2a4\ucf00\uc904 \ubcf5\uc0ac\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."),console.error("Error cloning fixed schedule:",a)}})(e),className:"action-button clone",title:"\ubcf5\uc0ac",children:(0,n.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,n.jsx)("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),(0,n.jsx)("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]})}),(0,n.jsx)("button",{onClick:()=>(async e=>{const t=prompt("\uc801\uc6a9\ud560 \uc8fc\uc758 \uc2dc\uc791\uc77c\uc744 \uc785\ub825\ud558\uc138\uc694 (YYYY-MM-DD):",(new Date).toISOString().split("T")[0]);if(t)try{await r.applyFixedScheduleToWeek(e.id,t),alert("\uace0\uc815 \uc2a4\ucf00\uc904\uc774 \ud574\ub2f9 \uc8fc\uc5d0 \uc801\uc6a9\ub418\uc5c8\uc2b5\ub2c8\ub2e4.")}catch(a){v("\uc2a4\ucf00\uc904 \uc801\uc6a9\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."),console.error("Error applying schedule to week:",a)}})(e),className:"action-button apply",title:"\uc8fc\uac04 \uc801\uc6a9",disabled:!e.is_active,children:(0,n.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,n.jsx)("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),(0,n.jsx)("polyline",{points:"9,22 9,12 15,12 15,22"})]})}),(0,n.jsx)("button",{onClick:()=>(async e=>{try{e.is_active?await r.deactivateFixedSchedule(e.id,(new Date).toISOString().split("T")[0]):await r.activateFixedSchedule(e.id),await j()}catch(t){v("\uc2a4\ucf00\uc904 \uc0c1\ud0dc \ubcc0\uacbd\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."),console.error("Error toggling schedule status:",t)}})(e),className:"action-button toggle ".concat(e.is_active?"deactivate":"activate"),title:e.is_active?"\ube44\ud65c\uc131\ud654":"\ud65c\uc131\ud654",children:(0,n.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.is_active?(0,n.jsx)("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}):(0,n.jsx)("path",{d:"M9 12l2 2 4-4"})})}),(0,n.jsx)("button",{onClick:()=>(async e=>{if(window.confirm('"'.concat(e.name,'" \uace0\uc815 \uc2a4\ucf00\uc904\uc744 \uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?')))try{await r.deleteFixedSchedule(e.id),await j()}catch(t){v("\uace0\uc815 \uc2a4\ucf00\uc904 \uc0ad\uc81c\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."),console.error("Error deleting fixed schedule:",t)}})(e),className:"action-button delete",title:"\uc0ad\uc81c",children:(0,n.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,n.jsx)("polyline",{points:"3,6 5,6 21,6"}),(0,n.jsx)("path",{d:"M19,6V20a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6M8,6V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2V6"})]})})]})]},e.id))}),u&&(0,n.jsx)("div",{className:"modal-overlay",children:(0,n.jsxs)("div",{className:"modal-content fixed-schedule-modal",children:[(0,n.jsxs)("div",{className:"modal-header",children:[(0,n.jsx)("h2",{children:_?"\uace0\uc815 \uc2a4\ucf00\uc904 \uc218\uc815":"\uc0c8 \uace0\uc815 \uc2a4\ucf00\uc904 \uc0dd\uc131"}),(0,n.jsx)("button",{onClick:()=>h(!1),className:"modal-close",children:"\xd7"})]}),(0,n.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{_?await r.updateFixedSchedule(_.id,(0,s.A)((0,s.A)({},p),{},{user_id:String(p.user_id),is_active:!0})):await r.createFixedSchedule((0,s.A)((0,s.A)({},p),{},{user_id:String(p.user_id),is_active:!0})),await j(),h(!1),m(null)}catch(t){v("\uace0\uc815 \uc2a4\ucf00\uc904 \uc800\uc7a5\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."),console.error("Error saving fixed schedule:",t)}},className:"schedule-form",children:[(0,n.jsxs)("div",{className:"form-section",children:[(0,n.jsx)("h3",{children:"\uae30\ubcf8 \uc815\ubcf4"}),(0,n.jsxs)("div",{className:"form-row",children:[(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"user_id",children:"\uc9c1\uc6d0 *"}),(0,n.jsxs)("select",{id:"user_id",name:"user_id",value:p.user_id,onChange:e=>w(t=>(0,s.A)((0,s.A)({},t),{},{user_id:e.target.value})),className:"modern-select",required:!0,children:[(0,n.jsx)("option",{value:"",children:"\uc9c1\uc6d0\uc744 \uc120\ud0dd\ud558\uc138\uc694"}),t.map(e=>(0,n.jsxs)("option",{value:e.id,children:[e.full_name," (",e.position,")"]},e.id))]})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"name",children:"\uc2a4\ucf00\uc904 \uc774\ub984 *"}),(0,n.jsx)("input",{type:"text",id:"name",name:"name",value:p.name,onChange:e=>w(t=>(0,s.A)((0,s.A)({},t),{},{name:e.target.value})),className:"modern-input",placeholder:"\uc608: \uc815\uaddc \uadfc\ubb34, \uc544\ub974\ubc14\uc774\ud2b8 \uadfc\ubb34",required:!0})]})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"description",children:"\uc124\uba85"}),(0,n.jsx)("textarea",{id:"description",name:"description",value:p.description,onChange:e=>w(t=>(0,s.A)((0,s.A)({},t),{},{description:e.target.value})),className:"modern-textarea",placeholder:"\uc2a4\ucf00\uc904\uc5d0 \ub300\ud55c \uc124\uba85\uc744 \uc785\ub825\ud558\uc138\uc694",rows:2})]}),(0,n.jsxs)("div",{className:"form-row",children:[(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"effective_from",children:"\uc801\uc6a9 \uc2dc\uc791\uc77c *"}),(0,n.jsx)("input",{type:"date",id:"effective_from",name:"effective_from",value:p.effective_from,onChange:e=>w(t=>(0,s.A)((0,s.A)({},t),{},{effective_from:e.target.value})),className:"modern-input",required:!0})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"effective_until",children:"\uc801\uc6a9 \uc885\ub8cc\uc77c"}),(0,n.jsx)("input",{type:"date",id:"effective_until",name:"effective_until",value:p.effective_until,onChange:e=>w(t=>(0,s.A)((0,s.A)({},t),{},{effective_until:e.target.value})),className:"modern-input",placeholder:"\ube44\uc6cc\ub450\uba74 \uacc4\uc18d \uc801\uc6a9\ub429\ub2c8\ub2e4"})]})]})]}),(0,n.jsxs)("div",{className:"form-section",children:[(0,n.jsx)("h3",{children:"\uc8fc\uac04 \uc2a4\ucf00\uc904"}),(0,n.jsx)("div",{className:"weekly-form",children:l.map(e=>(0,n.jsxs)("div",{className:"day-form",children:[(0,n.jsx)("label",{className:"day-label",children:e.label}),(0,n.jsxs)("div",{className:"time-inputs",children:[(0,n.jsx)("input",{type:"time",value:p["".concat(e.key,"_start")],onChange:t=>w(a=>(0,s.A)((0,s.A)({},a),{},{["".concat(e.key,"_start")]:t.target.value})),className:"time-input",placeholder:"\uc2dc\uc791"}),(0,n.jsx)("span",{className:"time-separator",children:"~"}),(0,n.jsx)("input",{type:"time",value:p["".concat(e.key,"_end")],onChange:t=>w(a=>(0,s.A)((0,s.A)({},a),{},{["".concat(e.key,"_end")]:t.target.value})),className:"time-input",placeholder:"\uc885\ub8cc"})]})]},e.key))})]}),(0,n.jsxs)("div",{className:"form-actions",children:[(0,n.jsx)("button",{type:"button",onClick:()=>h(!1),className:"secondary-button",children:"\ucde8\uc18c"}),(0,n.jsx)("button",{type:"submit",className:"primary-button",children:_?"\uc218\uc815":"\uc0dd\uc131"})]})]})]})})]})}}}]);
//# sourceMappingURL=846.43466e5c.chunk.js.map