"use strict";(self.webpackChunkstore_inventory_system=self.webpackChunkstore_inventory_system||[]).push([[134],{4305:(e,s,a)=>{a.d(s,{A:()=>l});a(5043);var t=a(6183),n=a(579);const l=e=>{let{selectedWeek:s,onWeekChange:a}=e;const l=s===t.l.getCurrentWeekStart();return(0,n.jsxs)("div",{className:"week-selector",children:[(0,n.jsx)("button",{onClick:()=>{const e=new Date(s),t=new Date(e);t.setDate(e.getDate()-7),a(t.toISOString().split("T")[0])},className:"week-nav-btn",children:"\u2b05\ufe0f \uc774\uc804 \uc8fc"}),(0,n.jsxs)("div",{className:"week-display",children:[(0,n.jsx)("div",{className:"week-label",children:(e=>{const s=new Date(e),a=new Date(s);a.setDate(s.getDate()+6);const t=s.toLocaleDateString("ko-KR",{month:"short",day:"numeric"}),n=a.toLocaleDateString("ko-KR",{month:"short",day:"numeric"});return"".concat(t," ~ ").concat(n)})(s)}),!l&&(0,n.jsx)("button",{onClick:()=>{a(t.l.getCurrentWeekStart())},className:"current-week-btn",children:"\uc774\ubc88 \uc8fc\ub85c"})]}),(0,n.jsx)("button",{onClick:()=>{const e=new Date(s),t=new Date(e);t.setDate(e.getDate()+7),a(t.toISOString().split("T")[0])},className:"week-nav-btn",children:"\ub2e4\uc74c \uc8fc \u27a1\ufe0f"})]})}},6183:(e,s,a)=>{a.d(s,{l:()=>l});var t=a(2555),n=a(7800);class l{static async getScheduleByUserAndWeek(e,s){try{const{data:a,error:t}=await n.N.from(this.tableName).select("*").eq("user_id",e).eq("week_start_date",s).single();if(t){if("PGRST116"===t.code)return null;throw t}return a}catch(a){return console.error("Error getting schedule by user and week:",a),null}}static async createOrUpdateSchedule(e){try{const s=await this.getScheduleByUserAndWeek(e.user_id,e.week_start_date),a={user_id:e.user_id,week_start_date:e.week_start_date,monday_start:e.monday_start||null,monday_end:e.monday_end||null,tuesday_start:e.tuesday_start||null,tuesday_end:e.tuesday_end||null,wednesday_start:e.wednesday_start||null,wednesday_end:e.wednesday_end||null,thursday_start:e.thursday_start||null,thursday_end:e.thursday_end||null,friday_start:e.friday_start||null,friday_end:e.friday_end||null,saturday_start:e.saturday_start||null,saturday_end:e.saturday_end||null,sunday_start:e.sunday_start||null,sunday_end:e.sunday_end||null};if(s){const{data:e,error:t}=await n.N.from(this.tableName).update(a).eq("id",s.id).select().single();if(t)throw t;return e}{const{data:e,error:s}=await n.N.from(this.tableName).insert(a).select().single();if(s)throw s;return e}}catch(s){throw console.error("Error creating or updating schedule:",s),s}}static async getWeekSchedules(e){try{const{data:s,error:a}=await n.N.from(this.tableName).select("\n          *,\n          users!inner(\n            full_name,\n            is_active\n          )\n        ").eq("week_start_date",e).eq("users.is_active",!0);if(a)throw a;return(s||[]).map(e=>(0,t.A)((0,t.A)({},e),{},{user_name:e.users.full_name})).sort((e,s)=>e.user_name.localeCompare(s.user_name))}catch(s){return console.error("Error getting week schedules:",s),[]}}static async deleteSchedule(e,s){try{const{error:a}=await n.N.from(this.tableName).delete().eq("user_id",e).eq("week_start_date",s);if(a)throw a;return!0}catch(a){return console.error("Error deleting schedule:",a),!1}}static getWeekDates(e){const s=new Date(e),a=[];for(let t=0;t<7;t++){const e=new Date(s);e.setDate(s.getDate()+t),a.push(e.toISOString().split("T")[0])}return a}static getCurrentWeekStart(){const e=new Date,s=e.getDay(),a=e.getDate()-s+(0===s?-6:1);return new Date(e.setDate(a)).toISOString().split("T")[0]}static getWeekStartByDate(e){const s=new Date(e),a=s.getDay(),t=s.getDate()-a+(0===a?-6:1);return new Date(s.setDate(t)).toISOString().split("T")[0]}}l.tableName="work_schedules"},8134:(e,s,a)=>{a.r(s),a.d(s,{default:()=>i});var t=a(2555),n=a(5043),l=a(6183),r=a(4305),d=a(579);const c=e=>{let{users:s,selectedWeek:a,getUserSchedule:l,onScheduleSave:r,onScheduleDelete:c}=e;const[i,u]=(0,n.useState)(null),[o,m]=(0,n.useState)({}),h=[{key:"monday",label:"\uc6d4"},{key:"tuesday",label:"\ud654"},{key:"wednesday",label:"\uc218"},{key:"thursday",label:"\ubaa9"},{key:"friday",label:"\uae08"},{key:"saturday",label:"\ud1a0"},{key:"sunday",label:"\uc77c"}],y=()=>{u(null),m({})},_=()=>{i&&(r(i,o),u(null),m({}))},v=(e,s)=>{m(a=>(0,t.A)((0,t.A)({},a),{},{[e]:s}))},N=e=>e?e.slice(0,5):"-",k=e=>!!e&&h.some(s=>e["".concat(s.key,"_start")]||e["".concat(s.key,"_end")]),x=e=>{if(!e)return 0;let s=0;return h.forEach(a=>{const t=e["".concat(a.key,"_start")],n=e["".concat(a.key,"_end")];if(t&&n){const e=new Date("2000-01-01T".concat(t));let a=new Date("2000-01-01T".concat(n)).getTime()-e.getTime();a<0&&(a+=864e5),s+=a/6e4}}),Math.round(s/60*10)/10};return(0,d.jsxs)("div",{className:"schedule-grid",children:[(0,d.jsxs)("div",{className:"schedule-table",children:[(0,d.jsxs)("div",{className:"table-header",children:[(0,d.jsx)("div",{className:"user-column-header",children:"\uc9c1\uc6d0"}),h.map(e=>(0,d.jsx)("div",{className:"day-column-header",children:e.label},e.key)),(0,d.jsx)("div",{className:"actions-column-header",children:"\ucd1d \uc2dc\uac04"}),(0,d.jsx)("div",{className:"actions-column-header",children:"\uad00\ub9ac"})]}),s.map(e=>{const s=l(Number(e.id)),a=i===Number(e.id),t=x(s);return(0,d.jsxs)("div",{className:"schedule-row",children:[(0,d.jsx)("div",{className:"user-cell",children:(0,d.jsxs)("div",{className:"user-info",children:[(0,d.jsx)("div",{className:"user-name",children:e.full_name}),(0,d.jsx)("div",{className:"user-position",children:e.position})]})}),h.map(e=>(0,d.jsx)("div",{className:"day-cell",children:a?(0,d.jsxs)("div",{className:"time-inputs",children:[(0,d.jsx)("input",{type:"time",value:o["".concat(e.key,"_start")]||"",onChange:s=>v("".concat(e.key,"_start"),s.target.value),className:"time-input"}),(0,d.jsx)("span",{className:"time-separator",children:"~"}),(0,d.jsx)("input",{type:"time",value:o["".concat(e.key,"_end")]||"",onChange:s=>v("".concat(e.key,"_end"),s.target.value),className:"time-input"})]}):(0,d.jsx)("div",{className:"time-display",children:null!==s&&void 0!==s&&s["".concat(e.key,"_start")]&&null!==s&&void 0!==s&&s["".concat(e.key,"_end")]?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("span",{className:"start-time",children:N(s["".concat(e.key,"_start")])}),(0,d.jsx)("span",{className:"time-separator",children:"~"}),(0,d.jsx)("span",{className:"end-time",children:N(s["".concat(e.key,"_end")])})]}):(0,d.jsx)("span",{className:"no-schedule",children:"\ud734\ubb34"})})},e.key)),(0,d.jsx)("div",{className:"hours-cell",children:(0,d.jsxs)("span",{className:"weekly-hours",children:[t,"\uc2dc\uac04"]})}),(0,d.jsx)("div",{className:"actions-cell",children:a?(0,d.jsxs)("div",{className:"edit-actions",children:[(0,d.jsx)("button",{onClick:_,className:"save-btn",title:"\uc800\uc7a5",children:"\u2705"}),(0,d.jsx)("button",{onClick:y,className:"cancel-btn",title:"\ucde8\uc18c",children:"\u274c"})]}):(0,d.jsxs)("div",{className:"view-actions",children:[(0,d.jsx)("button",{onClick:()=>(e=>{const s=l(Number(e.id));u(Number(e.id)),m({monday_start:(null===s||void 0===s?void 0:s.monday_start)||"",monday_end:(null===s||void 0===s?void 0:s.monday_end)||"",tuesday_start:(null===s||void 0===s?void 0:s.tuesday_start)||"",tuesday_end:(null===s||void 0===s?void 0:s.tuesday_end)||"",wednesday_start:(null===s||void 0===s?void 0:s.wednesday_start)||"",wednesday_end:(null===s||void 0===s?void 0:s.wednesday_end)||"",thursday_start:(null===s||void 0===s?void 0:s.thursday_start)||"",thursday_end:(null===s||void 0===s?void 0:s.thursday_end)||"",friday_start:(null===s||void 0===s?void 0:s.friday_start)||"",friday_end:(null===s||void 0===s?void 0:s.friday_end)||"",saturday_start:(null===s||void 0===s?void 0:s.saturday_start)||"",saturday_end:(null===s||void 0===s?void 0:s.saturday_end)||"",sunday_start:(null===s||void 0===s?void 0:s.sunday_start)||"",sunday_end:(null===s||void 0===s?void 0:s.sunday_end)||""})})(e),className:"edit-btn",title:"\ud3b8\uc9d1",children:"\u270f\ufe0f"}),k(s)&&(0,d.jsx)("button",{onClick:()=>c(Number(e.id)),className:"delete-btn",title:"\uc2a4\ucf00\uc904 \uc0ad\uc81c",children:"\ud83d\uddd1\ufe0f"})]})})]},e.id)})]}),s.length>0&&(0,d.jsxs)("div",{className:"schedule-summary",children:[(0,d.jsxs)("div",{className:"summary-item",children:[(0,d.jsx)("span",{className:"summary-label",children:"\ucd1d \uc9c1\uc6d0:"}),(0,d.jsxs)("span",{className:"summary-value",children:[s.length,"\uba85"]})]}),(0,d.jsxs)("div",{className:"summary-item",children:[(0,d.jsx)("span",{className:"summary-label",children:"\uc2a4\ucf00\uc904 \uc124\uc815 \uc644\ub8cc:"}),(0,d.jsxs)("span",{className:"summary-value",children:[s.filter(e=>k(l(Number(e.id)))).length,"\uba85"]})]}),(0,d.jsxs)("div",{className:"summary-item",children:[(0,d.jsx)("span",{className:"summary-label",children:"\uc804\uccb4 \uc608\uc0c1 \uadfc\ubb34\uc2dc\uac04:"}),(0,d.jsxs)("span",{className:"summary-value",children:[s.reduce((e,s)=>e+x(l(Number(s.id))),0).toFixed(1),"\uc2dc\uac04"]})]})]})]})},i=e=>{let{users:s,onScheduleUpdate:a}=e;const[i,u]=(0,n.useState)(l.l.getCurrentWeekStart()),[o,m]=(0,n.useState)([]),[h,y]=(0,n.useState)(!1),[_,v]=(0,n.useState)(null);(0,n.useEffect)(()=>{N()},[i]);const N=async()=>{try{y(!0),v(null);const e=await l.l.getWeekSchedules(i);m(e)}catch(e){v("\uc2a4\ucf00\uc904\uc744 \ubd88\ub7ec\uc624\ub294\ub370 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."),console.error("Error loading schedules:",e)}finally{y(!1)}};return(0,d.jsxs)("div",{className:"schedule-management",children:[(0,d.jsxs)("div",{className:"schedule-header",children:[(0,d.jsxs)("div",{className:"schedule-title",children:[(0,d.jsx)("h2",{children:"\ud83d\udcc5 \uc8fc\uac04 \uc2a4\ucf00\uc904 \uad00\ub9ac"}),(0,d.jsx)("p",{className:"schedule-subtitle",children:"\uc9c1\uc6d0\ub4e4\uc758 \uc8fc\uac04 \uadfc\ubb34 \uc2a4\ucf00\uc904\uc744 \uc124\uc815\ud558\uace0 \uad00\ub9ac\ud569\ub2c8\ub2e4"})]}),(0,d.jsx)(r.A,{selectedWeek:i,onWeekChange:u})]}),_&&(0,d.jsxs)("div",{className:"error-message",children:[(0,d.jsx)("span",{className:"error-icon",children:"\u26a0\ufe0f"}),_,(0,d.jsx)("button",{onClick:()=>v(null),className:"error-close",children:"\xd7"})]}),(0,d.jsxs)("div",{className:"schedule-info",children:[(0,d.jsxs)("div",{className:"week-info",children:[(0,d.jsx)("span",{className:"week-label",children:"\uc120\ud0dd\ub41c \uc8fc:"}),(0,d.jsx)("span",{className:"week-range",children:(e=>{const s=new Date(e),a=new Date(s);return a.setDate(s.getDate()+6),"".concat(s.toLocaleDateString("ko-KR")," ~ ").concat(a.toLocaleDateString("ko-KR"))})(i)})]}),(0,d.jsxs)("div",{className:"user-count",children:["\ud65c\uc131 \uc9c1\uc6d0: ",s.length,"\uba85"]})]}),h?(0,d.jsxs)("div",{className:"loading-container",children:[(0,d.jsx)("div",{className:"loading-spinner"}),(0,d.jsx)("p",{children:"\uc2a4\ucf00\uc904\uc744 \ubd88\ub7ec\uc624\ub294 \uc911..."})]}):0===s.length?(0,d.jsxs)("div",{className:"empty-state",children:[(0,d.jsx)("div",{className:"empty-icon",children:"\ud83d\udc65"}),(0,d.jsx)("h3",{children:"\ud65c\uc131 \uc9c1\uc6d0\uc774 \uc5c6\uc2b5\ub2c8\ub2e4"}),(0,d.jsx)("p",{children:"\uba3c\uc800 \uc9c1\uc6d0\uc744 \ub4f1\ub85d\ud574\uc8fc\uc138\uc694."})]}):(0,d.jsx)(c,{users:s,selectedWeek:i,getUserSchedule:e=>o.find(s=>Number(s.user_id)===Number(e)),onScheduleSave:async(e,s)=>{try{await l.l.createOrUpdateSchedule((0,t.A)({user_id:String(e),week_start_date:i},s)),await N(),a()}catch(n){v("\uc2a4\ucf00\uc904 \uc800\uc7a5\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."),console.error("Error saving schedule:",n)}},onScheduleDelete:async e=>{try{await l.l.deleteSchedule(String(e),i),await N(),a()}catch(s){v("\uc2a4\ucf00\uc904 \uc0ad\uc81c\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."),console.error("Error deleting schedule:",s)}}})]})}}}]);
//# sourceMappingURL=134.f79b510d.chunk.js.map